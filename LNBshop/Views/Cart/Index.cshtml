@model List<LNBshop.Models.CartItem>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Cart view section -->
<section id="cart-view">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="cart-view-area">
                    <div class="cart-view-table">
                        @if (Model.Count > 0)
                        {
                            <form action="">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Sản phẩm</th>
                                                <th>Tên sản phẩm</th>
                                                <th>Gía tiền</th>
                                                <th>Số lượng</th>
                                                <th>Thành tiền</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            @{
                                                var Total = 0;
                                            }
                                            @foreach (var item in Model)
                                            {
                                                <tr>
                                                    <td><a href="#" data-id="@item.Product.ID" class="btn-delete"><fa class="fa fa-close"></fa></a></td>
                                                    <td><a href="/chi-tiet"><img src="@item.Product.Image" alt="img"></a></td>
                                                    <td><a class="aa-cart-title" href="#">@item.Product.Name</a></td>
                                                    <td>@(item.Product.PromotionPrice.HasValue? item.Product.PromotionPrice.Value.ToString("N0"):item.Product.Price.Value.ToString("N0"))<sup>đ</sup></td>
                                                    <td><input class="txtQuantity" type="number" data-id="@item.Product.ID" value="@item.Quantity" min="1"></td>
                                                    <td>@(((item.Product.PromotionPrice.HasValue ? item.Product.PromotionPrice.Value : item.Product.Price.Value) * item.Quantity).ToString("N0"))</td>
                                                </tr>
                                                Total += Convert.ToInt32((item.Product.PromotionPrice.HasValue ? item.Product.PromotionPrice.Value : item.Product.Price.Value) * item.Quantity);
                                            }
                                            <tr>
                                                <td colspan="6" class="aa-cart-view-bottom">
                                                    <div class="aa-cart-coupon">
                                                        <a href="javascript:history.go(-1)" class="aa-cart-view-btn">Tiếp tục lựa sản phẩm</a>
                                                    </div>
                                                    <input class="aa-cart-view-btn" id="btnUpdate" type="submit" value="cập nhật tính tiền">
                                                    <input class="aa-cart-view-btn" id="btnDeleteAll" type="submit" value="Xóa giỏ hàng">
                                                </td>
                                            </tr>
                                        </tbody>

                                    </table>
                                </div>
                            </form>
                            <!-- Cart Total view -->
                            <div class="cart-view-total">
                                <h4>Cart Totals</h4>
                                <table class="aa-totals-table">
                                    <tbody>
                                        <tr>
                                            <th>Tổng:</th>
                                            <td>@Total.ToString("N0") <sup>đ</sup></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <a href="#" class="aa-cart-view-btn" id="btnPayment">Thanh toán</a>
                            </div>
                        }
                        else
                        {
                            <center>
                                <span class="alert alert-danger">Giỏ hàng rỗng</span>
                            </center>
                        }

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- / Cart view section -->

<!-- Code injected by live-server -->
<script type="text/javascript">
    // <![CDATA[  <-- For SVG support
    if ('WebSocket' in window) {
        (function () {
            function refreshCSS() {
                var sheets = [].slice.call(document.getElementsByTagName("link"));
                var head = document.getElementsByTagName("head")[0];
                for (var i = 0; i < sheets.length; ++i) {
                    var elem = sheets[i];
                    var parent = elem.parentElement || head;
                    parent.removeChild(elem);
                    var rel = elem.rel;
                    if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
                        var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
                        elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
                    }
                    parent.appendChild(elem);
                }
            }
            var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
            var address = protocol + window.location.host + window.location.pathname + '/ws';
            var socket = new WebSocket(address);
            socket.onmessage = function (msg) {
                if (msg.data == 'reload') window.location.reload();
                else if (msg.data == 'refreshcss') refreshCSS();
            };
            if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
                console.log('Live reload enabled.');
                sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
            }
        })();
    }
    else {
        console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
    }
</script>